---
description: "Mandatory workflow standards - AGENTS.md enforcement"
alwaysApply: true
---

# CRITICAL: Workflow Standards

**READ AGENTS.md (base constitution) — symlinked from ~/.agents_toolkit/ and applies to all changes.**

## Prime Directives

1. **NEVER begin implementation without a GitHub issue**
2. **NEVER write code before issue scope is approved**
3. **ALWAYS document work in GitHub issues and PRs**
4. **ALWAYS provide clickable markdown hyperlinks for GitHub resources**

## Workflow Commands

These scripts enforce AGENTS.md standards (repo-local, symlinked from toolkit):

- `.agents/commands/issue.py "Title" "Body"` - Create issue + branch
- `.agents/commands/branch.py [type] "description"` - Create branch
- `.agents/commands/status.py` - Check workflow state
- `.agents/commands/pr.py` - Create pull request
- `.agents/commands/link.py <pr> <issue>` - Link PR to issue
- `.agents/commands/followup.py <issue> "comment"` - Add issue comment

Cursor slash commands (`/status`, `/issue`, etc.) are backed by markdown wrappers in `.cursor/commands/` that call these scripts.

## Branch Naming (AGENTS.md Requirement)

**Format:** `{type}/{issue-num}-{description}` or `{type}/pending-{description}`

**Types:** `fix/`, `feat/`, `refactor/`, `docs/`, `chore/`

**Examples:**
- `fix/42-null-reference-upload`
- `feat/57-user-export-csv`
- `refactor/pending-auth-module` (before issue creation)

## Screenshot Handling

**Directory:** `.issue_screenshots/` (committed to repo)

**Naming:** `YYYYMMDD_{issue-num}_{branch-name}_{description}.{ext}`

**Workflow:**
1. Create branch first
2. Save screenshots to `.issue_screenshots/`
3. Commit and push
4. Create issue (screenshots embedded via raw GitHub URLs)

## Commit Standards

**Format:** `#{issue-num}: {imperative description}`

**Examples:**
- `#42: Add null check before document serialization`
- `#57: Implement CSV export endpoint`

## Pull Request Protocol

**Use the script:** `.agents/commands/pr.py`

**Required sections:**
- Summary
- Changes
- How to Test
- Known Limitations
- `Closes #{issue-num}`

## Your Role

1. **Decide WHEN** to act (based on AGENTS.md rules)
2. **Verify BRANCH** before any file changes (must NOT be main/master)
3. **Execute via scripts** (for deterministic results)
4. **Verify output** and continue

### Pre-Change Checkpoint

**Before modifying ANY files, verify:**
- [ ] Issue exists for this work
- [ ] On feature branch: run `git branch --show-current` (must NOT show main/master)
- [ ] Branch follows `{type}/{issue-num}-{desc}` format

**If on main/master: STOP and create feature branch first.**

## Command Execution & Safety

### Execution Environment
- Run all `gh`/`git` commands using the terminal tool with elevation (executes in the user's shell where `gh auth` is configured).
- Do **not** pre-check or warn about authentication; execute scripts directly.
- Do **not** claim sandbox/network limitations; elevate and execute.

### Safety Tiers
- **Tier 1 (execute immediately):** `gh issue/pr create/edit/comment/view/list/ready`, `gh issue/pr view/list/status`, `gh repo view`, `gh api` GET/read-only, `git add/commit/push` (no `--force`), `git checkout`, `git branch` create/rename, `git pull/fetch`, `git status/log/diff/show`.
- **Tier 2 (ask confirmation):** `gh issue close`, `gh pr close`, or any action that manually bypasses the issue → PR → merge flow.
- **Tier 3 (never auto-run):** `gh issue delete`, `gh pr merge`, `gh repo delete/archive`, `gh api` DELETE; `git branch -d/-D`, `git push --delete`, `git reset --hard`, `git push --force`, `git clean -fd`, interactive history rewrites. Only run if the user explicitly requests.

### Anti-Patterns
- ❌ "I can't run this because we're in a sandbox."
- ❌ Pre-checking `gh auth` before execution (elevation already has auth).
- ❌ Auto-merging PRs or deleting resources without explicit user request.

## Anti-Patterns (Prohibited)

- ❌ Starting to code before issue exists
- ❌ Making file changes while on main/master
- ❌ Committing directly to main/master
- ❌ Creating branches off branches
- ❌ Expanding scope without user approval
- ❌ Leaving failed approaches undocumented
- ❌ Referencing screenshots before committing them
- ❌ Providing non-clickable GitHub URLs
- ❌ Manually closing issues (auto-close on PR merge)

**The issue is the contract. The PR is the delivery. Documentation is the proof.**
